<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§ÙŠØ¬</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: sans-serif;
    }

    body {
      background: radial-gradient(circle, #001f3f, #003366, #000000);
      color: white;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    .screen {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
    }

    .active {
      display: flex !important;
    }

    .circle {
      width: 150px;
      height: 150px;
      background: radial-gradient(circle, orange, red, darkred);
      color: white;
      font-size: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      box-shadow: 0 4px 15px rgba(255, 69, 0, 0.8);
      margin-bottom: 30px;
      transition: all 0.3s ease;
    }

    button {
      padding: 10px 20px;
      background-color: #27ae60;
      color: white;
      border: none;
      border-radius: 25px;
      font-size: 18px;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
      transition: background-color 0.3s ease;
    }

    button:hover {
      background-color: #219150;
    }

    input[type="password"] {
      padding: 10px;
      font-size: 16px;
      border-radius: 8px;
      border: none;
      margin-bottom: 15px;
      width: 200px;
      text-align: center;
    }

    .error {
      color: red;
      margin-top: 10px;
      font-size: 14px;
    }

    #passwordDisplay {
      font-size: 24px;
      font-weight: bold;
      color: yellow;
      margin-top: 20px;
    }

    .footer-text {
      position: absolute;
      bottom: 10px;
      font-size: 14px;
      color: white;
      text-align: center;
      width: 100%;
      animation: glow 1.5s ease-in-out infinite;
    }

    @keyframes glow {
      0% {
        color: #f39c12;
        text-shadow: 0 0 5px #f39c12, 0 0 10px #f39c12, 0 0 20px #f39c12;
      }
      50% {
        color: #e67e22;
        text-shadow: 0 0 10px #e67e22, 0 0 20px #e67e22, 0 0 30px #e67e22;
      }
      100% {
        color: #f39c12;
        text-shadow: 0 0 5px #f39c12, 0 0 10px #f39c12, 0 0 20px #f39c12;
      }
    }
  </style>
</head>
<body>

  <div class="screen active" id="passwordScreen">
    <input type="password" id="passwordInput" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" />
    <button onclick="checkPassword()">Ø¯Ø®ÙˆÙ„</button>
    <div class="error" id="errorText"></div>
    <button class="admin-btn" onclick="showAdminPasswordScreen()">Ø£Ø¯Ù…Ù†</button>
  </div>

  <div class="screen" id="resultsScreen">
    <div class="circle" id="circle">-</div>
    <button onclick="showNext()">Ø§Ù„ØªØ§Ù„ÙŠ</button>
    <div class="footer-text">ØªØ·ÙˆÙŠØ± Ø§Ù„ÙƒÙŠÙ†Ø¬ Ù„Ù„Ø§Ø³ÙƒØ±Ø¨Øª</div>
  </div>

  <div class="screen" id="adminPasswordScreen">
    <input type="password" id="adminPasswordInput" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ø£Ø¯Ù…Ù†" />
    <button onclick="checkAdminPassword()">Ø¯Ø®ÙˆÙ„ ÙƒØ£Ø¯Ù…Ù†</button>
    <div class="error" id="adminErrorText"></div>
  </div>

  <div class="screen" id="adminScreen">
    <div id="passwordDisplay">
      ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§.
      <span id="copyIcon" class="copy-icon" onclick="copyPassword()">&#x1F4CB;</span>
    </div>
    <div id="clientInfo" style="margin-top: 20px; font-size: 14px;"></div>
    <button onclick="logoutAdmin()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    <div class="footer-text">ØªØ·ÙˆÙŠØ± Ø§Ù„ÙƒÙŠÙ†Ø¬ Ù„Ù„Ø§Ø³ÙƒØ±Ø¨ØªğŸ”¥ğŸ”¥</div>
  </div>

   <script>
    
  const passwordScreen = document.getElementById('passwordScreen');
  const resultsScreen = document.getElementById('resultsScreen');
  const adminPasswordScreen = document.getElementById('adminPasswordScreen');
  const adminScreen = document.getElementById('adminScreen');
  const errorText = document.getElementById('errorText');
  const adminErrorText = document.getElementById('adminErrorText');
  const passwordDisplay = document.getElementById('passwordDisplay');

  const numbers = [
    6.85, 1.00, 15.72, 2.63, 4.64, 1.29, 1.23, 1.37, 1.13, 25.28,
    2.14, 3.34, 1.75, 1.16, 3.77, 6.63, 1.03, 20.26, 2.79
  ];

  let index = 0;
  let currentUsedPassword = null;

  function showNext() {
    const circle = document.getElementById('circle');
    circle.textContent = numbers[index % numbers.length] || "-";
    index++;
    if (index >= numbers.length) index = 0;
  }

  async function showClientInfo() {
    const res = await fetch('/client-info');
    const data = await res.json();

    const ip = data.ip || "ØºÙŠØ± Ù…ØªÙˆÙØ±";

    // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø²
    const userAgent = navigator.userAgent;
    const deviceInfo = `
      <strong>IP Address:</strong> ${ip}<br>
      <strong>Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ´ØºÙŠÙ„ / Ø§Ù„Ù…ØªØµÙØ­:</strong> ${userAgent}
    `;

    document.getElementById('clientInfo').innerHTML = deviceInfo;
  }

  if (adminScreen.classList.contains('active')) {
    showClientInfo();
  }

  // Ø£Ùˆ Ø´ØºÙ„Ù‡Ø§ Ø¨Ø¹Ø¯ Ù†Ø¬Ø§Ø­ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù†
  function checkAdminPassword() {
    const input = document.getElementById('adminPasswordInput').value;
    if (input === "115200") {
      adminPasswordScreen.classList.remove('active');
      adminScreen.classList.add('active');
      showClientInfo(); // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„
    } else {
      adminErrorText.textContent = "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!";
    }
  }
  async function checkPassword() {
    const input = document.getElementById('passwordInput').value;
    const res = await fetch('/check-password', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ password: input })
    });

    const data = await res.json();

    if (data.success) {
      passwordScreen.classList.remove('active');
      resultsScreen.classList.add('active');
      showNext();

      currentUsedPassword = input;
      localStorage.setItem('loginTime', Date.now().toString());
    } else {
      errorText.textContent = "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!";
    }
  }

  function showAdminPasswordScreen() {
    passwordScreen.classList.remove('active');
    adminPasswordScreen.classList.add('active');
  }

  function checkAdminPassword() {
    const input = document.getElementById('adminPasswordInput').value;
    if (input === "115200") {
      adminPasswordScreen.classList.remove('active');
      adminScreen.classList.add('active');
    } else {
      adminErrorText.textContent = "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!";
    }
  }

  function logoutAdmin() {
    adminScreen.classList.remove('active');
    passwordScreen.classList.add('active');
  }

  function copyPassword() {
    const password = localStorage.getItem('randomPassword');
    navigator.clipboard.writeText(password).then(() => {
      alert('ØªÙ… Ù†Ø³Ø® ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±!');
    }, err => {
      alert('ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®: ' + err);
    });
  }

  async function fetchPasswordFromServer() {
    try {
      const res = await fetch('/password');
      const data = await res.json();
      const newPassword = data.password;

      localStorage.setItem('randomPassword', newPassword);

      // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ø¯Ù…Ù†
      passwordDisplay.innerHTML = `ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: ${newPassword} <span id="copyIcon" class="copy-icon" onclick="copyPassword()">ğŸ“‹</span>`;

      // Ù„Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ ÙˆØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± â†’ ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ Ø¥Ø¬Ø¨Ø§Ø±ÙŠ
      if (
        resultsScreen.classList.contains('active') &&
        currentUsedPassword &&
        currentUsedPassword !== newPassword
      ) {
        logoutUser("ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŒ ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ù† Ø¬Ø¯ÙŠØ¯.");
      }
    } catch (err) {
      passwordDisplay.textContent = 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±.';
    }
  }

  function logoutUser(message) {
    resultsScreen.classList.remove('active');
    adminScreen.classList.remove('active');
    passwordScreen.classList.add('active');
    localStorage.removeItem('loginTime');
    currentUsedPassword = null;
    alert(message || "ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬.");
  }

// Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¬Ù„Ø³Ø© (Ø¹Ù†Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù†Ø§Ø¬Ø­)
localStorage.setItem('loginTime', Date.now().toString());

// Ø§Ù„ØªØ­Ù‚Ù‚ ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø© Ø¥Ù† Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù†ØªÙ‡Øª Ø¨Ø¹Ø¯ 30 Ø¯Ù‚ÙŠÙ‚Ø©
setInterval(() => {
  const loginTime = localStorage.getItem('loginTime');
  if (loginTime) {
    const now = Date.now();
    const diffMinutes = (now - parseInt(loginTime)) / (1000 * 60);
    if (diffMinutes >= 30) { // 30 Ø¯Ù‚ÙŠÙ‚Ø©
      logoutUser("Ø§Ù†ØªÙ‡Øª ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø¬Ù„Ø³Ø© Ø¨Ø¹Ø¯ 30 Ø¯Ù‚ÙŠÙ‚Ø©.");
    }
  }
}, 60 * 1000); // ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©

// Ø¯Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
function logoutUser(message) {
  alert(message);
  // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„ Ø§Ù„Ø´Ø§Ø´Ø§Øª
  resultsScreen.classList.remove('active');
  adminScreen.classList.remove('active');
  adminPasswordScreen.classList.remove('active');
  passwordScreen.classList.add('active');
  localStorage.removeItem('loginTime');
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± Ø£ÙˆÙ„ Ù…Ø±Ø©
fetchPasswordFromServer();

// Ø§Ù„ØªØ­Ø¯ÙŠØ« ÙƒÙ„ 30 Ø¯Ù‚ÙŠÙ‚Ø©
setInterval(fetchPasswordFromServer, 30 * 60 * 1000);
</script>


</body>
</html>
